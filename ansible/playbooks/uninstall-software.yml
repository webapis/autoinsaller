---
# Reference: ..\..\Semaphore_Uninstall_Guide.md
- name: Uninstall Application
  hosts: "{{ target_host }}"
  gather_facts: no
  vars:
    # Connection variables (populated from Semaphore Survey)
    ansible_user: "{{ target_username }}"
    ansible_password: "{{ target_password }}"
    ansible_connection: winrm
    ansible_winrm_server_cert_validation: ignore
    ansible_winrm_transport: ntlm

  tasks:
    - name: Uninstall Application via Product ID
      # The product_id is passed from the Semaphore Survey
      win_package:
        product_id: "{{ product_id }}"
        state: absent
        arguments: /quiet /norestart
      register: uninstall_result

    - name: Debug Output
      debug:
        var: uninstall_result